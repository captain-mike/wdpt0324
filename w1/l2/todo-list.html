<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>

    <div class="container">

        <div class="row mt-5">
            <input id="testo" type="text" class="form-control">
            <button id="salva" class="btn btn-primary">Salva</button>
        </div>

        <div class="row mt-5" id="target">
            <!-- <div class="col-6">
                <div class="card">
                    <span class="p-3">Comprare l'insalata</span> 
                    <button class="btn btn-danger">Delete</button>
                </div>
            </div> -->
        </div>

    </div>


    <script>

        //CRUD:
        /*
        C: Create 
        R: Read 
        U: Update 
        D: Delete 
        */

        let storage = localStorage.getItem('todo')

        let dati = storage ? JSON.parse(storage) : []

        const testo = document.querySelector('#testo');
        const salva = document.querySelector('#salva');
        const target = document.querySelector('#target');
        let id = 0



        dati.forEach(el => {
            //READ
            createCard(el.testo)
        })


        salva.addEventListener('click', function () {

            createCard(testo.value)
            save(testo.value)

        })


        function createCard(testo) {

            const col = document.createElement('div');
            const card = document.createElement('div');
            const span = document.createElement('span');
            const button = document.createElement('button');
            const updateButton = document.createElement('button');

            col.classList.add('col-6')
            card.classList.add('card')

            span.classList.add('p-3')
            span.contentEditable = true
            span.textContent = testo

            button.classList.add('btn', 'btn-danger')
            button.textContent = 'Delete'
            button.addEventListener('click', function(){
                 deleteTodo(col) 
            })

            updateButton.classList.add('btn', 'btn-warning')
            updateButton.textContent = 'Modifica'
            updateButton.addEventListener('click', function () {
                //UPDATE
                const elemento = dati.find(el => el.id === id)
                elemento.testo = span.textContent
                localStorage.setItem('todo', JSON.stringify(dati))
            })

            col.append(card)
            card.append(span, button, updateButton)

            target.append(col)
            id++
        }

        function deleteTodo(col){
            col.remove()//Rimuove la card dal DOM. 
            //DELETE
            const indice = dati.findIndex(dato => dato.id === id)
            dati.splice(indice, 1)

            //altro modo per eliminare da un array
            // dati = dati.filter(dato => dato.id !== id)

            localStorage.setItem('todo', JSON.stringify(dati))
        }

        function save(testo) {
            //create
            dati.push({
                id,
                testo
            })
            localStorage.setItem(`todo`, JSON.stringify(dati))
        }
    </script>

</body>

</html>